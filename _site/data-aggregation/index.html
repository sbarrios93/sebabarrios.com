<!DOCTYPE html><html domain=".com" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="default-src 'self';object-src 'none';script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com/ https://gist.github.com/ https://www.googletagmanager.com/ https://www.google-analytics.com https://cdn.jsdelivr.net;connect-src 'self' https://www.google-analytics.com https://api.github.com;style-src 'self' https://fonts.googleapis.com/ https://use.fontawesome.com/ 'unsafe-inline' https://github.githubassets.com/ https://cdn.jsdelivr.net https://rsms.me;img-src 'self' data:;font-src 'self' https://fonts.gstatic.com/ https://use.fontawesome.com/ https://cdn.jsdelivr.net https://rsms.me" http-equiv="Content-Security-Policy"><link href="/favicon.svg" rel="icon" type="image/svg+xml"><link href="/src/css/main.css" rel="stylesheet"><meta content="#f9c412" name="theme-color"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>Data Aggregation</title><meta content="Data Aggregation" prefix="og: http://ogp.me/ns#" property="og:title"><meta content="In this note, I use df for DataFrame, s for Series. Libraries # import pandas as pd # import pandas packageimport numpy as np Dataframe #..." name="description"><meta content="In this note, I use df for DataFrame, s for Series. Libraries # import pandas as pd # import pandas packageimport numpy as np Dataframe #..." prefix="og: http://ogp.me/ns#" property="og:description"><meta content="summary_large_image" name="twitter:card"><meta content="@itsmeseba" name="twitter:site"><meta content="@itsmeseba" name="twitter:creator"><meta content="https://sebabarrios.com/img/frontpage.png" prefix="og: http://ogp.me/ns#" property="og:image"><meta content="article" prefix="og: http://ogp.me/ns#" property="og:type"><link href="https://sebabarrios.com/data-aggregation/" rel="canonical"><meta content="https://sebabarrios.com/data-aggregation/" prefix="og: http://ogp.me/ns#" property="og:url"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Sebastián Barrios"><link href="/" rel="preconnect" crossorigin=""><link href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" rel="stylesheet" crossorigin="anonymous" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw"><script src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" defer="" crossorigin="anonymous" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH"></script><link href="/fontello/css/fontello.css" rel="stylesheet"><style>body {
      visibility: hidden;
      opacity: 0;
    }</style><noscript><style>body {
        visibility: visible;
        opacity: 1;
      }</style></noscript><script csp-hash="sha256-/dHkOf9Lia7ElL7HdkbKAIdGXoBAA5SeqMVMgGV/2CU=">if (/Mac OS X/.test(navigator.userAgent))
      document
        .documentElement
        .classList
        .add('apple')</script></head><body><script>function showContent() {
        document.body.style.visibility = 'visible';
        document.body.style.opacity = 1;
      }
      window.addEventListener('DOMContentLoaded', (event) => {
        showContent();
      });</script><header><nav><div id="nav"><a href="/" class="no-effect nav-item"><img alt="home" class="keep-original" src="/img/nav/home.svg" height="18" width="18"> <span>Sebastián Barrios</span></a><div class="nav-search" id="nav-search"><form><input aria-label="search notes (press &quot;/&quot; to focus &amp; &quot;ESC&quot; to close)" autocomplete="off" class="nav-search__input" id="nav-search__input" onfocusin="inFocus(this)" placeholder="search notes (press &quot;/&quot; to focus &amp; &quot;ESC&quot; to close)" type="search"></form><div id="nav-search__result-container" style="display: none;"><ul id="nav-search__ul"></ul><div id="nav-search__no-result" style="display: none;"><p>No results found.</p></div></div></div><a href="https://github.com/sbarrios93" class="no-effect nav-item nav-github" target="_blank"><img alt="github" class="keep-original" src="/img/nav/github.svg" height="20" width="20"></a></div><div id="reading-progress" aria-hidden="true"></div></nav><script src="/src/js/search.js?hash=1aae822ef9" defer="" async=""></script><div class="header-container"><div class="header-logo"><img alt="Data Aggregation" class="keep-original" src="/img/header/aggregation.png"></div><h1>Data Aggregation</h1><div id="more-info"><div id="note-tag"><a href="/tags/data-science/">Data Science</a></div><div id="last-modified">20-06-2021 / <a href="https://github.com/dinhanhthi/dinhanhthi.com/edit/dev/./posts/data-science/2019-12-07-data-aggregation.md">Edit on Github</a></div></div></div></header><main><article class="post-container"><div class="container mt-2 normal page-note"><div class="toc toc-common toc-js"><ol><li><a href="#libraries">Libraries #</a></li><li><a href="#dataframe">Dataframe #</a></li><li><a href="#group-dataset-using-groupby()">Group dataset using groupby() #</a></li><li><a href="#group-using-pivot_table()">Group using pivot_table() #</a></li><li><a href="#reorganizing-df-using-pivot()">Reorganizing df using pivot() #</a></li><li><a href="#change-shape-of-df-with-melt()">Change shape of df with melt() #</a></li><li><a href="#references">References #</a></li></ol></div><p>In this note, I use <code>df</code> for <code>DataFrame</code>, <code>s</code> for <code>Series</code>.</p><h2 id="libraries">Libraries <a href="#libraries" class="direct-link">#</a></h2><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment"># import pandas package</span><br><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</code></pre><h2 id="dataframe">Dataframe <a href="#dataframe" class="direct-link">#</a></h2><pre class="language-python"><code class="language-python">dataquest_aio <span class="token operator">=</span> <span class="token string">'https://raw.githubusercontent.com/dinhanhthi/dataquest-aio/master/step-2-data-analysis-and-visualization/'</span><br>dataset_url <span class="token operator">=</span> dataquest_aio <span class="token operator">+</span> <span class="token string">'course-4-data-cleaning-and-analysis/data/World_Happiness_2015.csv'</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>dataset_url<span class="token punctuation">)</span> <span class="token comment"># read the data set</span><br>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th></th><th>Country</th><th>Region</th><th>Happiness Rank</th><th>Happiness Score</th><th>Standard Error</th></tr></thead><tbody><tr><th>0</th><td>Switzerland</td><td>Western Europe</td><td>1</td><td>7.587</td><td>0.03411</td></tr><tr><th>1</th><td>Iceland</td><td>Western Europe</td><td>2</td><td>7.561</td><td>0.04884</td></tr><tr><th>2</th><td>Denmark</td><td>Western Europe</td><td>3</td><td>7.527</td><td>0.03328</td></tr><tr><th>3</th><td>Norway</td><td>Western Europe</td><td>4</td><td>7.522</td><td>0.03880</td></tr><tr><th>4</th><td>Canada</td><td>North America</td><td>5</td><td>7.427</td><td>0.03553</td></tr></tbody></table><h2 id="group-dataset-using-groupby()">Group dataset using <code>groupby()</code> <a href="#group-dataset-using-groupby()" class="direct-link">#</a></h2><p>Group <code>df</code> by column <code>Region</code> and then selct the column <code>Western Europe</code>,</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Region'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_group<span class="token punctuation">(</span><span class="token string">'Western Europe'</span><span class="token punctuation">)</span> <span class="token comment"># returns a df</span></code></pre><table><thead><tr><th></th><th>Country</th><th>Region</th><th>Happiness Rank</th><th>Happiness Score</th><th>Standard Error</th></tr></thead><tbody><tr><th>0</th><td>Switzerland</td><td>Western Europe</td><td>1</td><td>7.587</td><td>0.03411</td></tr><tr><th>1</th><td>Iceland</td><td>Western Europe</td><td>2</td><td>7.561</td><td>0.04884</td></tr><tr><th>2</th><td>Denmark</td><td>Western Europe</td><td>3</td><td>7.527</td><td>0.03328</td></tr><tr><th>3</th><td>Norway</td><td>Western Europe</td><td>4</td><td>7.522</td><td>0.03880</td></tr><tr><th>5</th><td>Finland</td><td>Western Europe</td><td>6</td><td>7.406</td><td>0.03140</td></tr></tbody></table><p>Select just the <code>Happiness Score</code> column and then find the <code>mean</code>,</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Region'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Happiness Score'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token comment"># other methods: size, max, min, count</span></code></pre><pre><code>Region
Australia and New Zealand          7.285000
Central and Eastern Europe         5.332931
Eastern Asia                       5.626167
Latin America and Caribbean        6.144682
Middle East and Northern Africa    5.406900
North America                      7.273000
Southeastern Asia                  5.317444
Southern Asia                      4.580857
Sub-Saharan Africa                 4.202800
Western Europe                     6.689619
Name: Happiness Score, dtype: float64
</code></pre><p>Apply multiple/custom functions,</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">max_min</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">:</span><br>  <span class="token keyword">return</span> group<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> group<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">,</span> max_min<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th></th><th></th><th colspan="3" halign="left">Happiness Rank</th><th colspan="3" halign="left">Happiness Score</th></tr><tr><th></th><th></th><th>mean</th><th>amax</th><th>max_min</th><th>mean</th><th>amax</th><th>max_min</th></tr><tr><th>Country</th><th>Region</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Afghanistan</th><th>Southern Asia</th><td>153</td><td>153</td><td>0</td><td>3.575</td><td>3.575</td><td>0.0</td></tr><tr><th>Albania</th><th>Central Europe</th><td>95</td><td>95</td><td>0</td><td>4.959</td><td>4.959</td><td>0.0</td></tr><tr><th>Algeria</th><th>Middle Africa</th><td>68</td><td>68</td><td>0</td><td>5.605</td><td>5.605</td><td>0.0</td></tr></tbody></table><p>If you wanna apply different functions on different columns,</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token string">'Happiness Rank'</span><span class="token punctuation">:</span> max_min<span class="token punctuation">,</span><br>    <span class="token string">'Happiness Score'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token string">'Standard Error'</span><span class="token punctuation">:</span> <span class="token string">'count'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th></th><th></th><th>Happiness Rank</th><th colspan="2" halign="left">Happiness Score</th></tr><tr><th></th><th></th><th>max_min</th><th>min</th><th>max</th></tr><tr><th>Country</th><th>Region</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Afghanistan</th><th>Southern Asia</th><td>0</td><td>3.575</td><td>3.575</td></tr><tr><th>Albania</th><th>Central Europe</th><td>0</td><td>4.959</td><td>4.959</td></tr><tr><th>Algeria</th><th>Middle Africa</th><td>0</td><td>5.605</td><td>5.605</td></tr></tbody></table><p>Or using <code>apply</code> and <code>lambda</code> function,</p><pre class="language-python"><code class="language-python">orders<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'shoes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="group-using-pivot_table()">Group using <code>pivot_table()</code> <a href="#group-using-pivot_table()" class="direct-link">#</a></h2><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/post/data/data-aggregation/pivoting_table_simple1-1920w.webp 1920w, /img/post/data/data-aggregation/pivoting_table_simple1-1280w.webp 1280w, /img/post/data/data-aggregation/pivoting_table_simple1-640w.webp 640w, /img/post/data/data-aggregation/pivoting_table_simple1-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/post/data/data-aggregation/pivoting_table_simple1-1920w.jpg 1920w, /img/post/data/data-aggregation/pivoting_table_simple1-1280w.jpg 1280w, /img/post/data/data-aggregation/pivoting_table_simple1-640w.jpg 640w, /img/post/data/data-aggregation/pivoting_table_simple1-320w.jpg 320w" type="image/jpeg"><img alt="An example of pivotting by a single column" class="img-90" src="/img/post/data/data-aggregation/pivoting_table_simple1.png" height="255" width="749" decoding="async" loading="lazy" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 749px) min(calc(var(--main-width) * 0.3404539385847797), 255px);background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 749 255'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAIAAAAR2vFGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAs0lEQVQImVXB0QqCMBQA0P3/n0Q5oRJKfI0i8xJuTs1prYdytqIMcUFuPXcOWjqu77q+gxfjcYBx93xaY86MZVGUA2QQHSgt0hTBegubEMIopoQS8tHaWrvyvPlo5E+nAcauM/FmM0RCIDuIYU/imBLSd50x5pywU8JEVYrjkXMuhECMJoc040VRcV7m+VdrOwzWGPsP9bqXUl4uVyXl+3GvZfO+3VTT3GXTKlXLWin1atsfAuyn6Nl8lC4AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&quot;)"></picture><br><em>An example of pivotting by a single column<sup><a href="https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/">[ref]</a></sup></em></p><p>Group by <code>Region</code> (as an index) and choosing <code>GDP</code> and <code>City</code> columns,<sup><a href="https://github.com/dinhanhthi/data-science-learning/blob/master/codecademy-data-science/course-10%20Data%20Analysis%20with%20Pandas/Aggregates%20in%20Pandas.ipynb" target="_blank" rel="noopener noreferrer">[ref]</a></sup></p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GDP'</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token string">'Region'</span><span class="token punctuation">)</span> <span class="token comment"># returns df</span></code></pre><table><thead><tr><th></th><th>Happiness Rank</th><th>Standard Error</th></tr><tr><th>Region</th><th></th><th></th></tr></thead><tbody><tr><th>Australia and New Zealand</th><td>9.5</td><td>0.037270</td></tr><tr><th>Central and Eastern Europe</th><td>79.0</td><td>0.045208</td></tr><tr><th>Eastern Asia</th><td>64.5</td><td>0.037225</td></tr></tbody></table><p>Apply some functions,</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GDP'</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">]</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><br><span class="token comment"># margins shows the "All" row</span></code></pre><table><thead><tr><th></th><th colspan="2" halign="left">mean</th><th colspan="2" halign="left">amax</th></tr><tr><th></th><th>Happiness Rank</th><th>Standard Error</th><th>Happiness Rank</th><th>Standard Error</th></tr><tr><th>Region</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Australia and New Zealand</th><td>9.5</td><td>0.037270</td><td>10</td><td>0.04083</td></tr><tr><th>Central and Eastern Europe</th><td>79.0</td><td>0.045208</td><td>134</td><td>0.06913</td></tr><tr><th>Eastern Asia</th><td>64.5</td><td>0.037225</td><td>100</td><td>0.05051</td></tr></tbody></table><h2 id="reorganizing-df-using-pivot()">Reorganizing df using <code>pivot()</code> <a href="#reorganizing-df-using-pivot()" class="direct-link">#</a></h2><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/post/data/data-aggregation/pivoting_simple_multicolumn-1920w.webp 1920w, /img/post/data/data-aggregation/pivoting_simple_multicolumn-1280w.webp 1280w, /img/post/data/data-aggregation/pivoting_simple_multicolumn-640w.webp 640w, /img/post/data/data-aggregation/pivoting_simple_multicolumn-320w.webp 320w" type="image/webp"><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/post/data/data-aggregation/pivoting_simple_multicolumn-1920w.jpg 1920w, /img/post/data/data-aggregation/pivoting_simple_multicolumn-1280w.jpg 1280w, /img/post/data/data-aggregation/pivoting_simple_multicolumn-640w.jpg 640w, /img/post/data/data-aggregation/pivoting_simple_multicolumn-320w.jpg 320w" type="image/jpeg"><img alt="An example of multi-column pivoting" class="img-90" src="/img/post/data/data-aggregation/pivoting_simple_multicolumn.png" height="395" width="943" decoding="async" loading="lazy" style="background-size:cover;contain-intrinsic-size: min(var(--main-width), 943px) min(calc(var(--main-width) * 0.4188759278897137), 395px);background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 943 395'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAIAAAD+GJp4AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAApElEQVQImTXKXQuCMBSA4f3//+OFQw2aQgZDCbrQmaXi2ewiUkhk29n6gN7b9yH3ScE4jsMgAZy11hit9aRU27bGmr7vQEpyZIwlcZYkOdtbreHW7YIgpWEW0iyOU0rTKCKnojjkOee8LEttzEPKM+e1EKKuL1V1bURTVWRSCgCUkhJAbxta6xAdokfnEb1z3nvi/zmH8zyvy/J6zmZdv/snPugN1J6hpO8PZCQAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&quot;)"></picture><br><em>An example of multi-column pivoting (<a href="https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/">ref</a>)</em></p><p>Make values in one columns be columns in a new "pivot" table,<sup><a href="https://github.com/dinhanhthi/data-science-learning/blob/master/codecademy-data-science/course-10%20Data%20Analysis%20with%20Pandas/Aggregates%20in%20Pandas.ipynb" target="_blank" rel="noopener noreferrer">[ref]</a></sup></p><pre class="language-python"><code class="language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span><br>                           <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'bar'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'baz'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'zoo'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>pivot_1 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'baz'</span><span class="token punctuation">)</span><br>pivot_2 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">]</span><br>pivot_3 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'zoo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>display_side_by_side<span class="token punctuation">(</span>df<span class="token punctuation">,</span> pivot_1<span class="token punctuation">,</span> pivot_2<span class="token punctuation">,</span> pivot_3<span class="token punctuation">)</span></code></pre><table><thead><tr><th></th><th>foo</th><th>bar</th><th>baz</th><th>zoo</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>A</td><td>1</td><td>x</td></tr><tr><th>1</th><td>one</td><td>B</td><td>2</td><td>y</td></tr><tr><th>2</th><td>one</td><td>C</td><td>3</td><td>z</td></tr><tr><th>3</th><td>two</td><td>A</td><td>4</td><td>q</td></tr><tr><th>4</th><td>two</td><td>B</td><td>5</td><td>w</td></tr><tr><th>5</th><td>two</td><td>C</td><td>6</td><td>t</td></tr></tbody></table><div class="col-2-flex"><table><thead><tr><th>bar</th><th>A</th><th>B</th><th>C</th></tr><tr><th>foo</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>1</td><td>2</td><td>3</td></tr><tr><th>two</th><td>4</td><td>5</td><td>6</td></tr></tbody></table><table><thead><tr><th>bar</th><th>A</th><th>B</th><th>C</th></tr><tr><th>foo</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>1</td><td>2</td><td>3</td></tr><tr><th>two</th><td>4</td><td>5</td><td>6</td></tr></tbody></table><table><thead><tr><th></th><th colspan="3" halign="left">baz</th><th colspan="3" halign="left">zoo</th></tr><tr><th>bar</th><th>A</th><th>B</th><th>C</th><th>A</th><th>B</th><th>C</th></tr><tr><th>foo</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>1</td><td>2</td><td>3</td><td>x</td><td>y</td><td>z</td></tr><tr><th>two</th><td>4</td><td>5</td><td>6</td><td>q</td><td>w</td><td>t</td></tr></tbody></table></div><p>For one who wanna know <code>display_side_by_side</code>, check <a href="/jupyter-notebook#display-dataframes-side-by-side">this note</a>.</p><h2 id="change-shape-of-df-with-melt()">Change shape of df with <code>melt()</code> <a href="#change-shape-of-df-with-melt()" class="direct-link">#</a></h2><p>Contrary to <code>pivot</code>, we now want to transform several columns into values of a single column,<sup><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html" target="_blank" rel="noopener noreferrer">[ref]</a></sup></p><pre class="language-python"><code class="language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>                   <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>                   <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>df<span class="token punctuation">,</span> id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>df<span class="token punctuation">,</span> id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>display_side_by_side<span class="token punctuation">(</span>df<span class="token punctuation">,</span> df1<span class="token punctuation">,</span> df2<span class="token punctuation">)</span></code></pre><div class="col-2-flex"><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>1</td><td>2</td></tr><tr><th>1</th><td>b</td><td>3</td><td>4</td></tr><tr><th>2</th><td>c</td><td>5</td><td>6</td></tr></tbody></table><table><thead><tr><th></th><th>A</th><th>variable</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>B</td><td>1</td></tr><tr><th>1</th><td>b</td><td>B</td><td>3</td></tr><tr><th>2</th><td>c</td><td>B</td><td>5</td></tr></tbody></table><table><thead><tr><th></th><th>A</th><th>variable</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>B</td><td>1</td></tr><tr><th>1</th><td>b</td><td>B</td><td>3</td></tr><tr><th>2</th><td>c</td><td>B</td><td>5</td></tr><tr><th>3</th><td>a</td><td>C</td><td>2</td></tr><tr><th>4</th><td>b</td><td>C</td><td>4</td></tr><tr><th>5</th><td>c</td><td>C</td><td>6</td></tr></tbody></table></div><h2 id="references">References <a href="#references" class="direct-link">#</a></h2><ul><li><a href="https://github.com/dinhanhthi/dataquest-aio/tree/master/step-2-data-analysis-and-visualization/course-4-data-cleaning-and-analysis">Data Cleaning and Analysis</a> on Dataquest.</li><li><a href="https://dinhanhthi.github.io/tools/github-html?https://github.com/dinhanhthi/dataquest-aio/blob/master/step-2-data-analysis-and-visualization/course-4-data-cleaning-and-analysis/notebooks_in_html/task-3-transforming-data-with-pandas.html">Transforming data with pandas</a> on Dataquest.</li><li><strong>pandas official</strong> -- <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html">Group By: split-apply-combine</a></li></ul></div><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Data Aggregation","image":["https://sebabarrios.com/img/post/data/data-aggregation/pivoting_table_simple1.png","https://sebabarrios.com/img/post/data/data-aggregation/pivoting_simple_multicolumn.png"],"author":"Sebastián Barrios","genre":"Insert a schema.org genre","url":"https://sebabarrios.com/data-aggregation/","mainEntityOfPage":"https://sebabarrios.com/data-aggregation/","datePublished":"07-12-2019","dateModified":"20-06-2021","description":"In this note, I use df for DataFrame, s for Series. Libraries # import pandas as pd # import pandas packageimport numpy as np Dataframe #..."}</script></article></main><footer><div class="social"><a href="https://github.com/sbarrios93" class="no-effect" title="Github"><img alt="Github" class="keep-original" src="/img/social/github.svg" height="20" width="20"> </a><a href="https://www.linkedin.com/in/sebastianbs/" class="no-effect" title="LinkedIn"><img alt="LinkedIn" class="keep-original" src="/img/social/linkedin.svg" height="20" width="20"> </a><a href="https://twitter.com/itsmeseba" class="no-effect" title="Twitter"><img alt="Twitter" class="keep-original" src="/img/social/twitter.svg" height="20" width="20"></a></div><a href="/" target="_blank">Sebastián Barrios &nbsp;©&nbsp; 2021 </a>&nbsp;•&nbsp; <a href="/about-the-notes/">About the notes </a>&nbsp;•&nbsp; <a href="/about/">About me</a></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script><script src="/src/js/min.js?hash=680af59e41" defer="" async=""></script></body></html>